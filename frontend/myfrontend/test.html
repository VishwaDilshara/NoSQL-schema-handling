<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Employee Management System</title>
  <style>
     * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .qualification-section {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e0e6ff;
        }

        .qualification-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e6ff;
        }

        .add-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .add-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .plus-btn {
            background: #28a745;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .plus-btn:hover {
            background: #218838;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        .qualification-input {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .qualification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .qualification-title {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
        }

        .qualification-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .qualification-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            position: relative;
            transition: all 0.3s ease;
        }

        .qualification-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .no-qualifications {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
            border: 2px dashed #ddd;
        }

        .saved-qualification {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .saved-qualification .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .saved-qualification-header {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            display: inline-block;
        }

        .button-group {
            display: flex;
            gap: 15px;
        }

        .button-group .submit-btn {
            flex: 1;
            margin-top: 0;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .qualification-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .container {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }
        }
  </style>
</head>
<body>
  <div class="container">
    <h1>Employee Management System</h1>

    <form id="employeeForm">
      <!-- Basic Information -->
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name *</label>
          <input type="text" id="firstName" name="firstName" required />
        </div>
        <div class="form-group">
          <label for="lastName">Last Name *</label>
          <input type="text" id="lastName" name="lastName" required />
        </div>
      </div>

      <div class="form-group">
        <label for="nic">NIC *</label>
        <input type="text" id="nic" name="nic" required />
      </div>

      <div class="section-title">Address Information</div>

      <div class="form-group">
        <label for="street">Street</label>
        <input type="text" id="street" name="street" />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">City</label>
          <input type="text" id="city" name="city" />
        </div>
        <div class="form-group">
          <label for="state">State</label>
          <input type="text" id="state" name="state" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="zipCode">Zip Code</label>
          <input type="text" id="zipCode" name="zipCode" />
        </div>
        <div class="form-group">
          <label for="country">Country</label>
          <input type="text" id="country" name="country" />
        </div>
      </div>

      <!-- Educational Qualifications -->
      <div class="section-title">Educational Qualifications</div>

      <div class="qualification-section">
        <!-- Dropdown + Input grouped together -->
        <div class="qualification-selector-and-input">
          <div class="qualification-selector">
            <select id="qualificationType" style="min-width: 200px; flex: 1;">
              <option value="">Select Qualification Type</option>
              <option value="education">Education</option>
              <option value="certification">Certification</option>
              <option value="experience">Experience</option>
            </select>
            <button
              type="button"
              class="add-btn"
              id="addQualificationBtn"
              onclick="addQualificationInput()"
              disabled
            >
              Add Qualification
            </button>
          </div>

          <!-- Input form appears right under dropdown -->
          <div id="qualificationInputs"></div>
        </div>

        <!-- Saved qualifications shown below -->
        <div id="savedQualifications">
          <div class="no-qualifications">
            No qualifications added yet. Select a type above and click "Add Qualification" to begin.
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="submit" class="submit-btn">Create Employee</button>
        <button type="button" class="submit-btn" onclick="window.location.href='index.html'">View Employee</button>
      </div>
    </form>

    <div id="message"></div>
  </div>

  <script>
    let qualificationCounter = 0;
    let qualifications = [];
    let activeInputs = {};

    document.getElementById('qualificationType').addEventListener('change', function () {
      const addBtn = document.getElementById('addQualificationBtn');
      addBtn.disabled = !this.value;
    });

    function addQualificationInput() {
      const typeSelect = document.getElementById('qualificationType');
      const selectedType = typeSelect.value;

      if (!selectedType) {
        showMessage('Please select a qualification type first.', 'error');
        return;
      }

      if (activeInputs[selectedType]) {
        showMessage('Please complete or remove the current ' + getTypeDisplayName(selectedType) + ' entry first.', 'error');
        return;
      }

      createQualificationInput(selectedType);
    }

    function createQualificationInput(type) {
      const inputsContainer = document.getElementById('qualificationInputs');
      const inputId = `input_${type}_${qualificationCounter++}`;

      const inputDiv = document.createElement('div');
      inputDiv.className = 'qualification-input';
      inputDiv.id = inputId;

      const typeDisplayName = getTypeDisplayName(type);
      let fieldsHTML = '';
      
      if (type === 'education') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Degree/Course</label>
              <input type="text" id="${inputId}_field1" required />
            </div>
            <div class="form-group">
              <label>Institution</label>
              <input type="text" id="${inputId}_field2" required />
            </div>
            <div class="form-group">
              <label>Year</label>
              <input type="number" id="${inputId}_field3" min="1900" max="2030" required />
            </div>
          </div>
        `;
      } else if (type === 'certification') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Certification Name</label>
              <input type="text" id="${inputId}_field1" required />
            </div>
            <div class="form-group">
              <label>Certification Year</label>
              <input type="number" id="${inputId}_field2" min="1900" max="2030" required />
            </div>
          </div>
        `;
      } else if (type === 'experience') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Position</label>
              <input type="text" id="${inputId}_field1" required />
            </div>
            <div class="form-group">
              <label>Office Name</label>
              <input type="text" id="${inputId}_field2" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Place</label>
              <input type="text" id="${inputId}_field3" required />
            </div>
            <div class="form-group">
              <label>Year</label>
              <input type="number" id="${inputId}_field4" min="1900" max="2030" required />
            </div>
          </div>
        `;
      }

      inputDiv.innerHTML = `
        <div class="qualification-header">
          <div class="qualification-title">${typeDisplayName}</div>
          <div class="qualification-actions">
            <button type="button" class="plus-btn" onclick="addMoreOfType('${type}')" title="Add another ${typeDisplayName}">+</button>
            <button type="button" class="remove-btn" onclick="removeQualificationInput('${inputId}', '${type}')">Remove</button>
          </div>
        </div>

        ${fieldsHTML}

        <div style="display: flex; gap: 10px; margin-top: 15px;">
          <button type="button" class="add-btn" onclick="saveQualification('${inputId}', '${type}')">Save ${typeDisplayName}</button>
        </div>
      `;

      inputsContainer.appendChild(inputDiv);
      activeInputs[type] = inputId;

      // Focus on first input
      document.getElementById(`${inputId}_field1`).focus();
    }

    function addMoreOfType(type) {
      const currentInputId = activeInputs[type];
      if (currentInputId && saveQualification(currentInputId, type, false)) {
        createQualificationInput(type);
      }
    }

    function saveQualification(inputId, type, showSuccessMessage = true) {
      let qualificationData = {};

      if (type === 'education') {
        const degree = document.getElementById(`${inputId}_field1`).value.trim();
        const institution = document.getElementById(`${inputId}_field2`).value.trim();
        const year = document.getElementById(`${inputId}_field3`).value.trim();

        if (!degree || !institution || !year) {
          showMessage('Please fill in all fields.', 'error');
          return false;
        }

        qualificationData = {
          degree: degree,
          institution: institution,
          year: parseInt(year)
        };
      } else if (type === 'certification') {
        const certificationName = document.getElementById(`${inputId}_field1`).value.trim();
        const certificationYear = document.getElementById(`${inputId}_field2`).value.trim();

        if (!certificationName || !certificationYear) {
          showMessage('Please fill in all fields.', 'error');
          return false;
        }

        qualificationData = {
          certificationName: certificationName,
          certificationYear: parseInt(certificationYear)
        };
      } else if (type === 'experience') {
        const position = document.getElementById(`${inputId}_field1`).value.trim();
        const officeName = document.getElementById(`${inputId}_field2`).value.trim();
        const place = document.getElementById(`${inputId}_field3`).value.trim();
        const year = document.getElementById(`${inputId}_field4`).value.trim();

        if (!position || !officeName || !place || !year) {
          showMessage('Please fill in all fields.', 'error');
          return false;
        }

        qualificationData = {
          position: position,
          officeName: officeName,
          place: place,
          year: parseInt(year)
        };
      }

      const qualId = `qual_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      const qualification = {
        id: qualId,
        type: type,
        data: qualificationData
      };

      qualifications.push(qualification);
      addToSavedQualifications(qualification);
      removeQualificationInput(inputId, type);

      if (showSuccessMessage) {
        showMessage(`${getTypeDisplayName(type)} saved successfully!`, 'success');
      }

      return true;
    }

    function addToSavedQualifications(qualification) {
      const savedContainer = document.getElementById('savedQualifications');
      const noQualMsg = savedContainer.querySelector('.no-qualifications');
      if (noQualMsg) noQualMsg.remove();

      const savedDiv = document.createElement('div');
      savedDiv.className = 'saved-qualification';
      savedDiv.id = qualification.id;

      const typeDisplayName = getTypeDisplayName(qualification.type);
      let fieldsHTML = '';

      if (qualification.type === 'education') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Degree/Course</label>
              <input type="text" value="${qualification.data.degree}" readonly style="background: #f8f9fa;" />
            </div>
            <div class="form-group">
              <label>Institution</label>
              <input type="text" value="${qualification.data.institution}" readonly style="background: #f8f9fa;" />
            </div>
            <div class="form-group">
              <label>Year</label>
              <input type="number" value="${qualification.data.year}" readonly style="background: #f8f9fa;" />
            </div>
          </div>
        `;
      } else if (qualification.type === 'certification') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Certification Name</label>
              <input type="text" value="${qualification.data.certificationName}" readonly style="background: #f8f9fa;" />
            </div>
            <div class="form-group">
              <label>Certification Year</label>
              <input type="number" value="${qualification.data.certificationYear}" readonly style="background: #f8f9fa;" />
            </div>
          </div>
        `;
      } else if (qualification.type === 'experience') {
        fieldsHTML = `
          <div class="form-row">
            <div class="form-group">
              <label>Position</label>
              <input type="text" value="${qualification.data.position}" readonly style="background: #f8f9fa;" />
            </div>
            <div class="form-group">
              <label>Office Name</label>
              <input type="text" value="${qualification.data.officeName}" readonly style="background: #f8f9fa;" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Place</label>
              <input type="text" value="${qualification.data.place}" readonly style="background: #f8f9fa;" />
            </div>
            <div class="form-group">
              <label>Year</label>
              <input type="number" value="${qualification.data.year}" readonly style="background: #f8f9fa;" />
            </div>
          </div>
        `;
      }

      savedDiv.innerHTML = `
        <button type="button" class="remove-btn" onclick="removeSavedQualification('${qualification.id}')">Remove</button>
        <div class="saved-qualification-header">${typeDisplayName}</div>
        <div style="margin-right: 80px;">
          ${fieldsHTML}
        </div>
      `;

      savedContainer.appendChild(savedDiv);
    }

    function removeQualificationInput(inputId, type) {
      const inputDiv = document.getElementById(inputId);
      if (inputDiv) {
        inputDiv.remove();
        delete activeInputs[type];
      }
    }

    function removeSavedQualification(qualId) {
      const savedDiv = document.getElementById(qualId);
      if (savedDiv) {
        savedDiv.remove();
        qualifications = qualifications.filter(q => q.id !== qualId);
        const savedContainer = document.getElementById('savedQualifications');
        if (qualifications.length === 0) {
          savedContainer.innerHTML = '<div class="no-qualifications">No qualifications added yet. Select a type above and click "Add Qualification" to begin.</div>';
        }
        showMessage('Qualification removed successfully!', 'success');
      }
    }

    function getTypeDisplayName(type) {
      switch (type) {
        case 'education': return 'Education';
        case 'certification': return 'Certification';
        case 'experience': return 'Experience';
        default: return 'Qualification';
      }
    }

    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => {
        messageDiv.innerHTML = '';
      }, 5000);
    }

    document.getElementById('employeeForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      // Prepare data in the structure expected by your backend
      const employeeData = {
        nic: formData.get('nic'),
        name: {
          firstName: formData.get('firstName'),
          lastName: formData.get('lastName')
        },
        address: {
          street: formData.get('street') || '',
          city: formData.get('city') || '',
          state: formData.get('state') || '',
          zipCode: formData.get('zipCode') || '',
          country: formData.get('country') || ''
        }
      };

      // Add qualifications in the structure expected by your backend
      const educationItems = qualifications.filter(q => q.type === 'education').map(q => q.data);
      const certificationItems = qualifications.filter(q => q.type === 'certification').map(q => q.data);
      const experienceItems = qualifications.filter(q => q.type === 'experience').map(q => q.data);

      if (educationItems.length > 0) {
        employeeData.education = educationItems;
      }
      if (certificationItems.length > 0) {
        employeeData.certification = certificationItems;
      }
      if (experienceItems.length > 0) {
        employeeData.experience = experienceItems;
      }

      try {
        const response = await fetch('http://localhost:5000/api/employees', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(employeeData)
        });

        const result = await response.json();

        if (response.ok) {
          showMessage(`Employee created successfully! ID: ${result.employee_id}`, 'success');
          this.reset();
          qualifications = [];
          qualificationCounter = 0;
          activeInputs = {};
          document.getElementById('qualificationType').value = '';
          document.getElementById('addQualificationBtn').disabled = true;
          document.getElementById('qualificationInputs').innerHTML = '';
          document.getElementById('savedQualifications').innerHTML = '<div class="no-qualifications">No qualifications added yet. Select a type above and click "Add Qualification" to begin.</div>';
        } else {
          showMessage(`Error: ${result.error}`, 'error');
        }
      } catch (error) {
        showMessage(`Network error: ${error.message}. Make sure the API server is running on localhost:5000`, 'error');
      }
    });
  </script>
</body>
</html>